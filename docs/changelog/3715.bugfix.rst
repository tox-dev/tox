Adopt CPython's subprocess stream handling to fix deadlocks and improve performance when reading subprocess output
